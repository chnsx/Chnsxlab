
<!doctype html>

<html>
<head>
  <meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1.0, user-scalable=yes">
  <meta name="theme-color" content="#4F7DC9">
  <meta charset="UTF-8">
  <title>å¾®è§‚ä¸­å›½åç«¯å·¥ä½œæµç¨‹ï¼ˆä¸‹ï¼‰</title>
  <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Source+Code+Pro:400|Roboto:400,300,400italic,500,700|Roboto+Mono">
  <link rel="stylesheet" href="//fonts.googleapis.com/icon?family=Material+Icons">
  <link rel="stylesheet" href="https://storage.googleapis.com/codelab-elements/codelab-elements.css">
  <link rel="stylesheet" href="../../css/style.css">
</head>
<body>
  <google-codelab-analytics gaid="UA-49880327-14"></google-codelab-analytics>
  <google-codelab codelab-gaid=""
                  id="05å¾®è§‚ä¸­å›½åç«¯å·¥ä½œæµç¨‹(ä¸‹)"
                  title="å¾®è§‚ä¸­å›½åç«¯å·¥ä½œæµç¨‹ï¼ˆä¸‹ï¼‰"
                  environment="web"
                  feedback-link="https://github.com/chnsx">
    
      <google-codelab-step label="[Aé˜Ÿ]ç¼–å†™æ§åˆ¶å™¨" duration="8">
        <p>æ§åˆ¶å™¨ç”¨äºå¤„ç†ç”¨æˆ·è¯·æ±‚å¹¶æä¾›å“åº”ï¼Œæ¯ä¸€ä¸ªæ§åˆ¶å™¨ç±»å¯ä»¥æä¾›ä¸€ä¸ªæˆ–å¤šä¸ªhandleræ–¹æ³•å¤„ç†ç”¨æˆ·è¯·æ±‚ã€‚æœ¬æ•™ç¨‹ä»¥å®ç°å‰è¿°æ¥å£1ã€2ä¸ºä¾‹ï¼Œåˆ†åˆ«ç¼–å†™ä¸€ä¸ªç”¨äºå¤„ç†ä¸ªäººåŒ»ç–—æ•°æ®çš„æ§åˆ¶å™¨å’Œå¤„ç†æ•´ä½“åŒ»ç–—æ•°æ®çš„æ§åˆ¶å™¨ã€‚</p>
<h2 is-upgraded>å®ç°æ¥å£1</h2>
<p>æ–°å»º<code>src/main/java/com/iceberry/controller/MedicalPersonalController.java</code>ç±»ç”¨äºå¤„ç†ä¸ªäººåŒ»ç–—æ•°æ®è¯·æ±‚ï¼Œåœ¨ç±»åä¸Šæ·»åŠ <code>@RestController</code>å’Œ<code>@RequestMapping("/medical/personal")</code>æ³¨è§£ï¼Œä½¿ä¹‹æˆä¸ºä¸€ä¸ªå¤„ç†è¯·æ±‚è·¯å¾„ä¸º<code>/medical/personal</code>çš„Resté£æ ¼æ§åˆ¶å™¨ã€‚ç°åœ¨è¯¥ç±»ä¸­çš„ä»£ç åº”è¯¥å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<pre><code language="language-java" class="language-java">package com.iceberry.controller;

import org.springframework.web.bind.annotation.RestController;
import org.springframework.web.bind.annotation.RequestMapping;

@RestController
@RequestMapping(&#34;/medical/personal&#34;)
public class MedicalPersonalController {}
</code></pre>
<p>å½“å‰æ­¤ç±»ä¸­æ²¡æœ‰ä»»ä½•å˜é‡å’Œæ–¹æ³•ï¼Œå› æ­¤ç°åœ¨å®ƒä¸èƒ½å¤„ç†ä»»ä½•è¯·æ±‚ã€‚æˆ‘ä»¬è¦åœ¨æ­¤æ§åˆ¶å™¨ä¸­æ·»åŠ ç”¨äºå®ç°æ¥å£1çš„å†…å®¹ï¼Œé¦–å…ˆéœ€è¦åˆ›å»ºä¸€ä¸ª<code>getM24B</code>æ–¹æ³•ï¼Œå®ƒæœ‰ä¸¤ä¸ªå‚æ•°<code>id</code>å’Œ<code>year</code>ï¼Œæ ¹æ®æ¥å£ç»™å‡ºçš„æ ¼å¼ï¼Œidä¸ºåŠ¨æ€è·¯å¾„ï¼Œyearä¸ºæŸ¥è¯¢å‚æ•°ï¼Œè¦å¤„ç†çš„è·¯å¾„ä¸º<code>/medical/personal/{id}/disease?year={year}</code>ï¼Œè¿”å›ç±»å‹ä¸ºé”®å€¼å¯¹ã€‚äºæ˜¯æˆ‘ä»¬å¯ä»¥å¾—åˆ°å¦‚ä¸‹æ–¹æ³•ï¼š</p>
<pre><code language="language-java" class="language-java">@GetMapping(&#34;/{id}/disease&#34;)
public Map&lt;String, Object&gt; getM24B(@PathVariable(&#34;id&#34;) String id, @RequestParam(&#34;year&#34;) String year) {
    return null;
}
</code></pre>
<aside class="warning"><p>æ–¹æ³•åæœ€å¥½èƒ½ä½“ç°å‡ºè¦å®ç°çš„åŠŸèƒ½ï¼Œä¸è¦å–ä¸€äº›æ— æ„ä¹‰çš„å­—æ¯æˆ–å•è¯</p>
</aside>
<p>ç°åœ¨æˆ‘ä»¬å¹¶ä¸çŸ¥é“å…·ä½“çš„å¤„ç†é€»è¾‘ï¼Œå› æ­¤è¿”å›å€¼æš‚å®šä¸º<code>null</code>ï¼Œå½“Serviceå±‚å®ç°åï¼Œå†å°†å…·ä½“å¤„ç†é€»è¾‘è¡¥å……å®Œæ•´ã€‚</p>
<p>ğŸ‘‰è¯¥ç±»çš„å®Œæ•´ä»£ç è¯¦è§<a href="https://github.com/chnsx/chnsx-backend/blob/main/src/main/java/com/iceberry/controller/MedicalPersonalController.java" target="_blank">MedicalPersonalController.java</a></p>
<h2 is-upgraded>å®ç°æ¥å£2</h2>
<p>æ–°å»º<code>src/main/java/com/iceberry/controller/MedicalStatisticsController.java</code>ç±»ï¼Œç”¨äºå¤„ç†æ•´ä½“åŒ»ç–—æ•°æ®è¯·æ±‚ï¼Œåœ¨ç±»åä¸Šæ·»åŠ <code>@RestController</code>å’Œ<code>@RequestMapping("/medical/statistics")</code>æ³¨è§£ï¼Œä½¿ä¹‹æˆä¸ºä¸€ä¸ªå¤„ç†è¯·æ±‚è·¯å¾„ä¸º<code>/medical/statistics</code>çš„Resté£æ ¼æ§åˆ¶å™¨ã€‚ç°åœ¨è¯¥ç±»ä¸­çš„ä»£ç åº”è¯¥å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<pre><code language="language-java" class="language-java">package com.iceberry.controller;

import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RestController;

@RestController
@RequestMapping(&#34;/medical/statistics&#34;)
public class MedicalStatisticsController {}
</code></pre>
<p>å½“å‰æ­¤ç±»ä¸­æ²¡æœ‰ä»»ä½•å˜é‡å’Œæ–¹æ³•ï¼Œå› æ­¤ç°åœ¨å®ƒä¸èƒ½å¤„ç†ä»»ä½•è¯·æ±‚ã€‚æˆ‘ä»¬è¦åœ¨æ­¤æ§åˆ¶å™¨ä¸­æ·»åŠ ç”¨äºå®ç°æ¥å£2çš„å†…å®¹ï¼Œé¦–å…ˆéœ€è¦åˆ›å»ºä¸€ä¸ª<code>getM24B</code>æ–¹æ³•ï¼Œå®ƒæœ‰ä¸€ä¸ªå‚æ•°<code>year</code>ï¼Œæ ¹æ®æ¥å£ç»™å‡ºçš„æ ¼å¼ï¼Œyearä¸ºæŸ¥è¯¢å‚æ•°ï¼Œè¦å¤„ç†çš„è·¯å¾„ä¸º<code>/medical/statistics/disease?year={year}</code>ï¼Œè¿”å›ç±»å‹ä¸ºé”®å€¼å¯¹ã€‚äºæ˜¯æˆ‘ä»¬å¯ä»¥å¾—åˆ°å¦‚ä¸‹æ–¹æ³•ï¼š</p>
<pre><code language="language-java" class="language-java">@GetMapping(&#34;/disease&#34;)
public Map&lt;String, Object&gt; getM24B(@RequestParam(&#34;year&#34;) String year) {
	return null;
}
</code></pre>
<p>ç°åœ¨æˆ‘ä»¬å¹¶ä¸çŸ¥é“å…·ä½“çš„å¤„ç†é€»è¾‘ï¼Œå› æ­¤è¿”å›å€¼æš‚å®šä¸º<code>null</code>ï¼Œå½“Serviceå±‚å®ç°åï¼Œå†å°†å…·ä½“å¤„ç†é€»è¾‘è¡¥å……å®Œæ•´ã€‚</p>
<p>ğŸ‘‰è¯¥ç±»çš„å®Œæ•´ä»£ç è¯¦è§<a href="https://github.com/chnsx/chnsx-backend/blob/main/src/main/java/com/iceberry/controller/MedicalStatisticsController.java" target="_blank">MedicalStatisticsController.java</a></p>
<p>ç±»ä¼¼çš„ï¼Œæ‚¨å¯ä»¥ç»§ç»­æ ¹æ®æ­¤æµç¨‹å®Œæˆæ¥å£3-9çš„æ§åˆ¶å™¨å®ç°ã€‚</p>


      </google-codelab-step>
    
      <google-codelab-step label="[Bé˜Ÿ]ç¼–å†™mapperå±‚å’Œæ˜ å°„æ–‡ä»¶" duration="7">
        <p>mapperå±‚ç”¨äºä¸æ•°æ®åº“è¿›è¡Œäº¤äº’ï¼Œæ¯ä¸€ä¸ªmapperç±»å¯ä»¥æä¾›ä¸€ä¸ªæˆ–å¤šä¸ªæ–¹æ³•ç”¨äºå¤„ç†æ•°æ®åº“çš„æ–¹æ³•ã€‚æœ¬æ•™ç¨‹ä»¥å®ç°å‰è¿°æ¥å£1ã€2ä¸ºä¾‹ï¼Œåˆ†åˆ«ç¼–å†™ä¸€ä¸ªç”¨äºå¤„ç†ä¸ªäººåŒ»ç–—æ•°æ®çš„æ§åˆ¶å™¨å’Œå¤„ç†æ•´ä½“åŒ»ç–—æ•°æ®çš„mapperç±»ã€‚</p>
<h2 is-upgraded>ç¼–å†™mapperå±‚</h2>
<h3 is-upgraded>å®ç°æ¥å£1</h3>
<p>æ–°å»º<code>src/main/java/com/iceberry/mapper/MedicalMapper.java</code>æ¥å£ç”¨äºå¤„ç†æ•°æ®åº“ä¸­ä¸åŒ»ç–—ç›¸å…³çš„æ•°æ®ï¼Œåœ¨ç±»åä¸Šæ·»åŠ <code>@Repository</code>æ³¨è§£ä»¥å°†å…¶æ·»åŠ åˆ°Springçš„Beanå®¹å™¨ä¸­ã€‚ç°åœ¨è¯¥ç±»ä¸­çš„ä»£ç åº”è¯¥å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<pre><code language="language-java" class="language-java">package com.iceberry.mapper;

import org.springframework.stereotype.Repository;

@Repository
public interface MedicalMapper {}
</code></pre>
<p>ä¸‹é¢æˆ‘ä»¬éœ€è¦ä¸ºå®ç°æ¥å£1æä¾›ä¸€ä¸ªmapperå±‚æŠ½è±¡æ–¹æ³•<code>findHlth12One</code>ï¼Œè¯¥æ–¹æ³•æ¥æ”¶ä¸¤ä¸ªæŸ¥è¯¢å‚æ•°<code>id</code>å’Œ<code>year</code>ï¼Œè¿”å›å€¼ç±»å‹ä¸º<code>Map<String,Object></code>ï¼Œè¯¥æ–¹æ³•æ‰€ä½¿ç”¨çš„Sqlè¯­å¥ä½¿ç”¨<code>@Select</code>æ³¨è§£æ ‡è¯†ï¼Œæ­¤æ—¶ï¼Œè¯¥æ–¹æ³•å¯ä»¥æ ¹æ®Sqlè¯­å¥å°†æŸ¥è¯¢åˆ°çš„æ•°æ®æ•´åˆä¸ºä¸€ä¸ªMapå¯¹è±¡è¿”å›ã€‚è¯¥æ–¹æ³•çš„ä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<pre><code language="language-java" class="language-java">/**
 * æ ¹æ®idå’Œå¹´ä»½æŸ¥è¯¢hlth_12è¡¨ä¸€ä¸ª
 *
 * @param id è¦æŸ¥è¯¢çš„Id
 * @param year è¦æŸ¥è¯¢çš„å¹´ä»½
 * @return æŸ¥è¯¢åˆ°çš„æ•°æ®,åŒ…è£…æˆMapå¯¹è±¡
 */
@Select(&#34;SELECT * FROM hlth_12 WHERE IDind =#{id} AND wave =#{year}&#34;)
Map&lt;String, Object&gt; findHlth12One(String id, String year);
</code></pre>
<aside class="special"><p>å¹¶ä¸éœ€è¦ç¼–å†™Mapperæ¥å£çš„å®ç°ç±»ï¼Œæ‰€æœ‰å®ç°ç»†èŠ‚å‡ç”±Mybatisæ¡†æ¶åœ¨æ„å»ºæ—¶ç”Ÿæˆã€‚</p>
</aside>
<h3 is-upgraded>å®ç°æ¥å£2</h3>
<p>ä¸‹é¢æˆ‘ä»¬éœ€è¦ä¸ºå®ç°æ¥å£2æä¾›ä¸€ä¸ªmapperå±‚æŠ½è±¡æ–¹æ³•<code>findAllDiseasePrevalence</code>ï¼Œè¯¥æ–¹æ³•æ¥æ”¶ä¸€ä¸ªæŸ¥è¯¢å‚æ•°<code>year</code>ï¼Œè¿”å›å€¼ç±»å‹ä¸º<code>Map<String,Object></code>ï¼Œè¯¥æ–¹æ³•æ‰€ä½¿ç”¨çš„Sqlè¯­å¥ç”±äºå†…å®¹è¿‡å¤šä¸é€‚å®œä½¿ç”¨<code>@Select</code>æ³¨è§£åœ¨ç±»ä¸­æ ‡è¯†ï¼Œè€Œæ˜¯åº”è¯¥å­˜æ”¾åœ¨æ˜ å°„æ–‡ä»¶ä¸­ã€‚æ­¤æ—¶ï¼Œè¯¥æ–¹æ³•å¯ä»¥æ ¹æ®Sqlè¯­å¥å°†æŸ¥è¯¢åˆ°çš„æ•°æ®æ•´åˆä¸ºä¸€ä¸ªMapå¯¹è±¡è¿”å›ã€‚è¯¥æ–¹æ³•çš„ä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<pre><code language="language-java" class="language-java">/**
 * æ ¹æ®å¹´ä»½è·å–å½“å¹´æ‰€æœ‰ç–¾ç—…æ‚£ç—…ç‡
 *
 * @param year
 * @return
 */
Map&lt;String, Object&gt; findAllDiseasePrevalence(String year);
</code></pre>
<p>ğŸ‘‰è¯¥æ¥å£çš„å®Œæ•´ä»£ç è¯¦è§<a href="https://github.com/chnsx/chnsx-backend/blob/main/src/main/java/com/iceberry/mapper/MedicalMapper.java" target="_blank">MedicalMapper.java</a></p>
<h2 is-upgraded>ç¼–å†™æ˜ å°„æ–‡ä»¶</h2>
<p>æ–°å»º<code>src/main/resources/mybatis/mapper/mysql/MedicalMapper.xml</code>æ–‡ä»¶ç”¨äºå­˜æ”¾æŸ¥è¯¢æ•´ä½“åŒ»ç–—æ•°æ®çš„Sqlè¯­å¥ã€‚ä¸ºå®ç°æ¥å£2ï¼Œæˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ª<code>mapper</code>æ ‡ç­¾ï¼Œå…¶<code>namespace</code>å±æ€§ä¸ºå®ç°æ¥å£2çš„mapperæ¥å£çš„ç»å¯¹è·¯å¾„ã€‚å®ç°æ¥å£2éœ€è¦ä½¿ç”¨æŸ¥è¯¢è¯­å¥ï¼Œäºæ˜¯å»ºç«‹<code>select</code>æ ‡ç­¾ï¼Œå…¶<code>id</code>å±æ€§ä¸ºåœ¨å¯¹åº”<code>mapper</code>æ¥å£ä¸­è´Ÿè´£å¤„ç†è¯¥è¡Œä¸ºçš„æŠ½è±¡æ–¹æ³•åï¼Œ<code>resultType</code>å±æ€§ä¸ºMybatisæ¡†æ¶æ‰§è¡Œæ“ä½œååº”è¿”å›çš„javaæ•°æ®ç±»å‹ã€‚</p>
<pre><code language="language-xml" class="language-xml">&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34; ?&gt;
&lt;!DOCTYPE mapper
        PUBLIC &#34;-//mybatis.org//DTD Mapper 3.0//EN&#34;
        &#34;http://mybatis.org/dtd/mybatis-3-mapper.dtd&#34;&gt;
&lt;mapper namespace=&#34;com.iceberry.mapper.MedicalMapper&#34;&gt;
    &lt;select id=&#34;findAllDiseasePrevalence&#34; resultType=&#34;Map&#34;&gt;
		SELECT ......
    &lt;/select&gt;
&lt;/mapper&gt;
</code></pre>
<p>ğŸ‘‰è¯¥æ˜ å°„æ–‡ä»¶çš„å®Œæˆä»£ç è¯¦è§<a href="https://github.com/chnsx/chnsx-backend/blob/main/src/main/resources/mybatis/mapper/mysql/MedicalMapper.xml" target="_blank">MedicalMapper.xml</a></p>
<p>å‰©ä½™æ¥å£3-9çš„Mapperå±‚å‡å¯é€šè¿‡ä¸Šè¿°æµç¨‹å®ç°ã€‚</p>


      </google-codelab-step>
    
      <google-codelab-step label="[Aé˜Ÿ]å®ç°æ—¥å¿—åŠŸèƒ½" duration="10">
        <p>æ­¤å¤„æ‰€æŒ‡çš„æ—¥å¿—ä¸»è¦æ˜¯æŒ‡Webè¯·æ±‚æ—¥å¿—ï¼Œç”¨äºè®°å½•æœåŠ¡ç«¯æ¥å£è¢«è®¿é—®çš„æƒ…å†µï¼Œå…¶å½¢å¼å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p class="image-container"><img alt="image-Webè¯·æ±‚æ—¥å¿—å›¾" src="img\\4a172d4b48c1cdd5.png"></p>
<p>é¡¹ç›®é‡‡ç”¨AOPæŠ€æœ¯å®ç°æ­¤åŠŸèƒ½ï¼Œåˆ‡å…¥ç‚¹ä¸ºæ‰€æœ‰Controllerï¼Œåœ¨æ–¹æ³•æ­£å¸¸è¿”å›ååˆ‡å…¥è®°å½•æ—¥å¿—çš„æ–¹æ³•ï¼Œæ—¥å¿—çš„æ ¼å¼å’Œå†…å®¹å¯ä»¥è‡ªå®šä¹‰ï¼Œæœ¬é¡¹ç›®è®°å½•è¯·æ±‚Ipã€è¯·æ±‚æ–¹æ³•ã€å“åº”çŠ¶æ€ã€æŸ¥è¯¢å‚æ•°ã€å¤„ç†è¯·æ±‚çš„Handleræ–¹æ³•ã€‚åœ¨æ–¹æ³•å‡ºé”™æ—¶ï¼Œç»Ÿä¸€å°†å“åº”ç è®¾ç½®ä¸º<code>SC_NOT_FOUND</code>ï¼Œå¹¶è®°å½•æ—¥å¿—ï¼Œä¸åœ¨æ§åˆ¶å°æŠ›å‡ºå¤§é‡é”™è¯¯ã€‚å…·ä½“åšæ³•å¦‚ä¸‹ï¼š</p>
<p>1.æ–°å»º<code>src/main/java/com/iceberry/aspect/LoggerAspect.java</code>ç±»ï¼Œä½¿ç”¨<code>@Aspect</code>æ³¨è§£æ ‡æ³¨è¯¥ç±»ä¸ºåˆ‡é¢ç±»ï¼Œä½¿ç”¨<code>@Component</code>æ³¨è§£ç®±Springæ³¨å†Œä¸ºç»„ä»¶ï¼Œ<code>@Order(2)</code>è¡¨ç¤ºæœ‰å¤šä¸ªåˆ‡é¢ç±»æ—¶æ‰§è¡Œçš„é¡ºåºã€‚æ­¤æ—¶ç±»ä¸­çš„ä»£ç åº”å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<pre><code language="language-java" class="language-java">package com.iceberry.aspect;

import org.aspectj.lang.annotation.Aspect;
import org.springframework.core.annotation.Order;
import org.springframework.stereotype.Component;

@Aspect
@Component
@Order(2)
public class LoggerAspect {}
</code></pre>
<p>2.ä¸‹é¢å®šä¹‰å‡ ä¸ªé™æ€å˜é‡ä¾›ä½¿ç”¨ï¼š</p>
<pre><code language="language-java" class="language-java">//å®šä¹‰æ—¥å¿—å¯¹è±¡
public static Logger logger = LoggerFactory.getLogger(LoggerAspect.class);

//å®šä¹‰è¯·æ±‚å‚æ•°å¯¹è±¡
public static ServletRequestAttributes attributes;

//å®šä¹‰Servletè¯·æ±‚å¯¹è±¡
public static HttpServletRequest request;

//å®šä¹‰Servletå“åº”å¯¹è±¡
public static HttpServletResponse response;

//å®šä¹‰æ ¼å¼åŒ–æ—¥æœŸå¯¹è±¡
public static SimpleDateFormat formatter = new SimpleDateFormat(&#34;yyyy-MM-dd HH:mm:ss z&#34;);
</code></pre>
<p>3.å®šä¹‰åˆ‡ç‚¹ã€‚åˆ‡ç‚¹è¡¨ç¤ºè¦æ³¨å…¥åˆ‡é¢çš„èŒƒå›´ï¼Œè¿™é‡Œåˆ‡ç‚¹ä¸ºæ‰€æœ‰Controllerç±»(<code>*Controller</code>)ï¼š</p>
<pre><code language="language-java" class="language-java">@Pointcut(&#34;bean(*Controller)&#34;)
public void pointCut() {}
</code></pre>
<p>4.å½“å¤„äºåˆ‡é¢ä¸Šçš„æ–¹æ³•æ­£å¸¸è¿”å›æ—¶æ‰§è¡Œ<code>doAfterRetuening</code>æ–¹æ³•ç”¨äºè®°å½•æ—¥å¿—ï¼š</p>
<pre><code language="language-java" class="language-java">@AfterReturning(&#34;pointCut()&#34;)
public void doAfterReturning(JoinPoint joinPoint) {......}
</code></pre>
<p>5.å®šä¹‰æ—¥å¿—æ ¼å¼ã€‚ä½¿ç”¨ç¬¬äºŒæ­¥ä¸­å®šä¹‰çš„å˜é‡ç»„åˆå‡ºè‡ªå·±æƒ³è¦çš„æ—¥å¿—æ ¼å¼ï¼Œé¡¹ç›®ä¸­ä½¿ç”¨çš„æ—¥å¿—æ ¼å¼å®šä¹‰å¦‚ä¸‹ï¼š</p>
<pre><code language="language-java" class="language-java">//ä»è¯·æ±‚ä¸Šä¸‹æ–‡Holderä¸­è·å–è¯·æ±‚å’Œå“åº”å¯¹è±¡
attributes = (ServletRequestAttributes) RequestContextHolder.getRequestAttributes();
request = attributes.getRequest();
response = attributes.getResponse();

//å®šä¹‰æ—¥å¿—æ ¼å¼ï¼Œ{}ä¸ºå ä½ç¬¦ï¼Œåé¢5ä¸ªå‚æ•°ä¸ºæ—¥å¿—è¦è®°å½•çš„å†…å®¹
logger.info(&#34;{} {} {} {} {}&#34;,
        request.getRemoteAddr(),
        request.getMethod(),
        response.getStatus(),
        request.getQueryString() != null ? (request.getRequestURL() + &#34;?&#34; + request.getQueryString()) : (request.getRequestURL()),
        joinPoint.getSignature().getDeclaringTypeName()+ &#34;.&#34; + joinPoint.getSignature().getName());
</code></pre>
<p>6.å¤„ç†æ–¹æ³•å‡ºé”™åçš„æ—¥å¿—æ ¼å¼ï¼Œè¯¥æ–¹æ³•åœ¨é”™è¯¯å¤„ç†å™¨æ‰§è¡Œä¹‹å‰æ‰§è¡Œï¼š</p>
<pre><code language="language-java" class="language-java">@Before(value = &#34;bean(*ExceptionHandler)&#34;)
    public void doBefore(JoinPoint joinPoint) {......}
</code></pre>
<aside class="special"><p>è¿™ä¸»è¦æ˜¯é¿å…æ§åˆ¶å°æ˜¾ç¤ºå¤§é‡é”™è¯¯å †æ ˆä¿¡æ¯ï¼Œå¦‚æœéœ€è¦æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯ï¼Œå¯ä»¥åˆ å»æ­¤æ–¹æ³•æˆ–è€…æ”¹é€ æ­¤æ–¹æ³•ä¸ºå·±ç”¨ã€‚</p>
</aside>
<p>ğŸ‘‰è‡³æ­¤ï¼Œæ—¥å¿—åŠŸèƒ½å®ç°å®Œæ¯•ï¼Œè¯¥åˆ‡é¢ç±»çš„å®Œæ•´ä»£ç è¯¦è§<a href="https://github.com/chnsx/chnsx-backend/blob/main/src/main/java/com/iceberry/aspect/LoggerAspect.java" target="_blank">LoggerAspect.java</a></p>


      </google-codelab-step>
    
      <google-codelab-step label="[ABé˜Ÿ]ç¼–å†™Serviceå±‚" duration="15">
        <p>Serviceä¸ºä¸šåŠ¡å±‚ï¼Œæ˜¯é¡¹ç›®ä¸­æœ€å¤æ‚å’Œæœ€æ ¸å¿ƒçš„éƒ¨åˆ†ï¼Œè¿™é‡Œæè¿°äº†å¦‚ä½•åŒ…è£…æ•°æ®ä¸ºä¸šåŠ¡æ‰€ç”¨ï¼Œå½“Aã€Bä¸¤é˜Ÿåˆ†åˆ«å®Œæˆäº†è‡ªå·±çš„ä»»åŠ¡åï¼Œå¯ä»¥å…±åŒå•†è®®Serviceå±‚çš„å®ç°ã€‚è¿™é‡Œæˆ‘ä»¬ä»ä»¥å®ç°æ¥å£1å’Œæ¥å£2ä¸ºä¾‹ã€‚</p>
<h2 is-upgraded>å®ç°æ¥å£1</h2>
<p>æ¥å£1çš„éœ€æ±‚æ˜¯è¦æŸ¥è¯¢æŸäºº(IDind)åœ¨æŸå¹´(wave)çš„æ‰€æœ‰åŒ»ç–—ä¿¡æ¯(M24B_*)ï¼Œmapperå±‚å·²ç»è·å–åˆ°ä»æ•°æ®åº“è·å¾—çš„æ•°æ®ï¼ŒServiceå±‚çš„å·¥ä½œä¸»è¦æ˜¯å°†mapperå±‚è·å¾—çš„æ•°æ®è¿›ä¸€æ­¥åŒ…è£…ï¼Œä»¥æ»¡è¶³éœ€æ±‚ã€‚æ­¤å¤„çš„åŒ…è£…æŒ‡çš„æ˜¯å»é™¤ç©ºå­—æ®µå’Œå°†è‹±æ–‡å­—æ®µè½¬æ¢ä¸ºä¸­æ–‡å­—æ®µã€‚å®ç°æ­¥éª¤å¦‚ä¸‹ï¼š</p>
<p>1.é¦–å…ˆåˆ›å»º<code>src/main/java/com/iceberry/service/MedicalService.java</code>æ¥å£ã€‚åœ¨æ¥å£ä¸­å®šä¹‰å®ç°æ¥å£1éœ€æ±‚çš„æŠ½è±¡æ–¹æ³•<code>findOneDiseases</code>ï¼Œè¯¥æ–¹æ³•æ¥æ”¶ä¸¤ä¸ªå‚æ•°idå’Œyearï¼Œè¿”å›ç±»å‹ä¸ºMapå¯¹è±¡ï¼š</p>
<pre><code language="language-java" class="language-java">package com.iceberry.service;

import java.util.List;
import java.util.Map;

public interface MedicalService {
    /**
     * æ ¹æ®Idå’Œå¹´ä»½æŸ¥æ‰¾hlth_12ä¸€åˆ—ï¼Œå¹¶ç­›é€‰å‡ºè¯¥äººå¾—è¿‡çš„ç—…
     *
     * @param id è¦æŸ¥è¯¢çš„Id
     * @param year è¦æŸ¥è¯¢çš„å¹´ä»½
     * @return å¤„ç†å¥½çš„æ•°æ®ï¼Œä»¥Mapå¯¹è±¡æä¾›
     */
    Map&lt;String, Object&gt; findOneDiseases(String id, String year);
}
</code></pre>
<p>2.åˆ›å»º<code>src/main/java/com/iceberry/service/impl/MedicalServiceImpl.java</code>å®ç°ç±»å®ç°<code>MedicalService</code>æ¥å£ã€‚ä½¿ç”¨Serviceæ³¨è§£æ ‡æ³¨å…¶ä¸ºä¸€ä¸ªSpring Beanå¯¹è±¡ã€‚</p>
<pre><code language="language-java" class="language-java">package com.iceberry.service.impl;

import com.iceberry.service.MedicalService;
import org.springframework.stereotype.Service;
import org.springframework.transaction.annotation.Propagation;
import org.springframework.transaction.annotation.Transactional;

import java.util.List;
import java.util.Map;

@Service
@Transactional(propagation = Propagation.REQUIRED, readOnly = false)
public class MedicalServiceImpl implements MedicalService {}
</code></pre>
<p>3.åˆ›å»ºç§æœ‰å˜é‡mapç”¨äºæ¥æ”¶mapperå±‚è¿”å›çš„æ•°æ®ã€è¿›è¡Œå»é™¤ç©ºå€¼å’Œæ›¿æ¢ä¸­æ–‡å­—æ®µçš„æ“ä½œï¼›è‡ªåŠ¨æ³¨å…¥<code>medicalMapper</code>å¯¹è±¡ç”¨äºè·å–ä»æ•°æ®åº“ä¸­æŸ¥è¯¢åˆ°çš„æ•°æ®ã€‚</p>
<pre><code language="language-java" class="language-java">private Map&lt;String, Object&gt; map;
@Autowired
private MedicalMapper medicalMapper;
</code></pre>
<p>4.é‡å†™<code>findOneDiseases</code>æ–¹æ³•ç”¨äºå®ç°å…·ä½“çš„æ•°æ®å¤„ç†æ“ä½œï¼š</p>
<pre><code language="language-java" class="language-java">@Override
public Map&lt;String, Object&gt; findOneDiseases(String id, String year) {
    //æ¥æ”¶mapperå±‚è¿”å›çš„æ•°æ®
    map = medicalMapper.findHlth12One(id, year);
    
    //å¦‚æœæ•°æ®ä¸ºç©ºï¼Œåˆ™æŠ›å‡ºé”™è¯¯ï¼Œå¯ä»¥æ•è·å¤šç§é”™è¯¯
    if (map == null) throw new DaoNullException(&#34;æ•°æ®åº“æŸ¥è¯¢ç»“æœä¸ºç©º&#34;);
    
    //ä½¿ç”¨mapçš„removeIfæ“ä½œé€šè¿‡æ­£åˆ™è¡¨è¾¾å¼åˆ é™¤æ•°æ®ä¸­é”®ä¸ä»¥&#39;M24B_&#39;å¼€å¤´çš„å­—æ®µï¼Œå› ä¸ºéœ€æ±‚ä¸­ä¸è¦è¿™äº›å­—æ®µ
    map.keySet().removeIf(it -&gt; !it.matches(&#34;^(M24B_).+$&#34;));
    
    //åˆ é™¤æ‰€æœ‰å€¼ä¸æ˜¯1çš„é¡¹ï¼Œå› ä¸ºéœ€æ±‚ä¸­ä¸éœ€è¦è¿™äº›å­—æ®µ
    map.values().removeIf(it -&gt; !it.toString().matches(&#34;^1$&#34;));
    
    //ä½¿ç”¨MapUtilså·¥å…·ç±»è½¬æ¢ä¸ºä¸­æ–‡å­—æ®µå¹¶è¿”å›
    return MapUtils.replaceAllKey(map, TableType.DISEASE);
}
</code></pre>
<p>6.è¡¥å……å®Œæ•´<code>MedicalPersonalController.java</code>ä¸­<code>getM24B</code>æ–¹æ³•ã€‚</p>
<pre><code language="language-java" class="language-java">//è‡ªåŠ¨æ³¨å…¥medicalServiceå¯¹è±¡
@Autowired
private MedicalService medicalService;

@GetMapping(&#34;/{id}/disease&#34;)
public Map&lt;String, Object&gt; getM24B(@PathVariable(&#34;id&#34;) String id, @RequestParam(&#34;year&#34;) String year) {
    //åˆ›å»ºå“åº”Mapå¯¹è±¡
    Map&lt;String, Object&gt; restfulMap = new HashMap&lt;&gt;();
    
    //åˆ›å»ºmapå¯¹è±¡æ¥æ”¶Serviceä¼ è¿‡æ¥çš„æ•°æ®
    Map&lt;String, Object&gt; map = medicalService.findOneDiseases(id, year);
    
    //å°†mapçš„é”®é›†åˆä½œä¸ºå“åº”Mapçš„dataå€¼è¿”å›
    restfulMap.put(&#34;data&#34;, map.keySet());
    return restfulMap;
}
</code></pre>
<aside class="special"><p>è‡³äºControllerçš„å®ç°ï¼Œåœ¨ç¼–å†™å®ŒServiceæ¥å£åå³å¯è¿›è¡Œï¼Œæ— éœ€ç­‰å¾…Serviceå±‚å®ç°å®Œæ¯•ã€‚</p>
</aside>
<p>ğŸ‘‰è‡³æ­¤ï¼Œæ¥å£1å®ç°å®Œæ¯•ï¼Œå®Œæ•´ä»£ç è¯¦è§<a href="https://github.com/chnsx/chnsx-backend/blob/main/src/main/java/com/iceberry/service/MedicalService.java" target="_blank">MedicalService.java</a>å’Œ<a href="https://github.com/chnsx/chnsx-backend/blob/main/src/main/java/com/iceberry/service/impl/MedicalServiceImpl.java" target="_blank">MedicalServiceImpl.java</a></p>
<h2 is-upgraded>å®ç°æ¥å£2</h2>
<p>æ¥å£2çš„éœ€æ±‚æ˜¯æŸ¥è¯¢æ‰€æœ‰ç–¾ç—…(M24B_*)åœ¨æŸå¹´(wave)çš„æ‚£ç—…ç‡ï¼Œmapperå±‚å·²ç»è·å–åˆ°ä»æ•°æ®åº“è·å¾—çš„æ•°æ®ï¼ŒServiceå±‚çš„å·¥ä½œä¸»è¦æ˜¯å°†mapperå±‚è·å¾—çš„æ•°æ®è¿›ä¸€æ­¥åŒ…è£…ï¼Œä»¥æ»¡è¶³éœ€æ±‚ã€‚æ­¤å¤„çš„åŒ…è£…æŒ‡çš„æ˜¯å»é™¤ç©ºå­—æ®µå’Œå°†è‹±æ–‡å­—æ®µè½¬æ¢ä¸ºä¸­æ–‡å­—æ®µã€‚å®ç°æ­¥éª¤å¦‚ä¸‹ï¼š</p>
<p>1.åœ¨<code>MedicalService</code>ç±»ä¸­åˆ›å»º<code>findAllDiseasePrevalence</code>æŠ½è±¡æ–¹æ³•ï¼Œè¯¥æ–¹æ³•æ¥æ”¶ä¸€ä¸ªå‚æ•°yearï¼Œè¿”å›ç±»å‹ä¸ºMapå¯¹è±¡ï¼š</p>
<pre><code language="language-java" class="language-java">/**
 * æ ¹æ®å¹´ä»½è·å–å½“å¹´æ‰€æœ‰ç–¾ç—…æ‚£ç—…ç‡
 *
 * @param year è¦æŸ¥è¯¢çš„å¹´ä»½
 * @return å¤„ç†å¥½çš„æ•°æ®ï¼Œä»¥Mapå¯¹è±¡æä¾›
 */
Map&lt;String, Object&gt; findAllDiseasePrevalence(String year);
</code></pre>
<p>2.åœ¨<code>MedicalServiceImpl.java</code>å®ç°ç±»ä¸­é‡å†™<code>findAllDiseasePrevalence</code>æ–¹æ³•ç”¨äºå®ç°å…·ä½“çš„æ•°æ®å¤„ç†æ“ä½œï¼š</p>
<pre><code language="language-java" class="language-java">@Override
public Map&lt;String, Object&gt; findAllDiseasePrevalence(String year) {
    //æ¥æ”¶mapperå±‚è¿”å›çš„æ•°æ®
    map = medicalMapper.findAllDiseasePrevalence(year);
    //å¦‚æœæ•°æ®ä¸ºç©ºï¼Œåˆ™æŠ›å‡ºé”™è¯¯ï¼Œå¯ä»¥æ•è·å¤šç§é”™è¯¯
    if (map == null) throw new DaoNullException(&#34;æ•°æ®åº“æŸ¥è¯¢ç»“æœä¸ºç©º&#34;);
    //ä½¿ç”¨mapçš„removeIfæ“ä½œé€šè¿‡æ­£åˆ™è¡¨è¾¾å¼åˆ é™¤æ•°æ®ä¸­é”®ä¸ä»¥&#39;M24B_&#39;å¼€å¤´çš„å­—æ®µï¼Œå› ä¸ºéœ€æ±‚ä¸­ä¸è¦è¿™äº›å­—æ®µ
    map.keySet().removeIf(it -&gt; !it.matches(&#34;^(M24B_).+$&#34;));
    //åˆ é™¤æ‰€æœ‰çœŸå€¼ä¸º0çš„é¡¹ï¼Œå› ä¸ºéœ€æ±‚ä¸­ä¸éœ€è¦è¿™äº›å­—æ®µ
    map.values().removeIf(it -&gt; it.toString().matches(&#34;^0*.0*$&#34;));
    //è½¬æ¢ä¸­æ–‡å­—æ®µå¹¶è¿”å›
    return MapUtils.replaceAllKey(map, TableType.DISEASE);
}
</code></pre>
<p>3.è¡¥å……å®Œæ•´<code>MedicalStatisticsController.java</code>ä¸­çš„&#34;getM24Bæ–¹æ³•ï¼š</p>
<pre><code language="language-java" class="language-java">//åˆ›å»ºå“åº”ä½“Mapå¯¹è±¡
Map&lt;String, Object&gt; restfulMap = new HashMap&lt;&gt;();

//è‡ªåŠ¨æ³¨å…¥medicalServiceå¯¹è±¡
@Autowired
private MedicalService medicalService;

@GetMapping(&#34;/disease&#34;)
public Map&lt;String, Object&gt; getM24B(@RequestParam(&#34;year&#34;) String year) {
    //åˆ›å»ºmapå¯¹è±¡æ¥æ”¶Serviceä¼ è¿‡æ¥çš„æ•°æ®
    Map&lt;String, Object&gt; map = medicalService.findAllDiseasePrevalence(year);
    
    //å°†mapçš„é”®é›†åˆä½œä¸ºå“åº”Mapçš„dataå€¼è¿”å›
    restfulMap.put(&#34;data&#34;, map);
    return restfulMap;
}
</code></pre>
<p>ğŸ‘‰è‡³æ­¤ï¼Œæ¥å£2å®ç°å®Œæ¯•ï¼Œå®Œæ•´ä»£ç è¯¦è§<a href="https://github.com/chnsx/chnsx-backend/blob/main/src/main/java/com/iceberry/service/MedicalService.java" target="_blank">MedicalService.java</a>å’Œ<a href="https://github.com/chnsx/chnsx-backend/blob/main/src/main/java/com/iceberry/service/impl/MedicalServiceImpl.java" target="_blank">MedicalServiceImpl.java</a></p>


      </google-codelab-step>
    
      <google-codelab-step label="[ABé˜Ÿ]ç¼–å†™å»é‡åˆ‡é¢å’Œå…¨å±€æ•è·å¼‚å¸¸" duration="10">
        <p>ç›®å‰Controllerè¿”å›ç»™å‰ç«¯çš„æ•°æ®åªæœ‰dataä¸€ä¸ªå­—æ®µï¼Œä½œä¸ºä¸€ä¸ªRestfulé£æ ¼çš„æ¥å£ï¼Œé™¤äº†dataå­—æ®µï¼Œè¿˜åº”è¯¥æœ‰çŠ¶æ€ç ã€ä¿¡æ¯ã€æ—¶é—´æˆ³ã€urlåœ°å€ç­‰ä¿¡æ¯ã€‚ä½†æ˜¯å¦‚æœä¸€ä¸ªæ¥å£ä¸€ä¸ªæ¥å£çš„å‘å“åº”Mapä¸­è¿½åŠ è¿™äº›è¾…åŠ©ä¿¡æ¯è¿‡äºéº»çƒ¦ï¼Œä»£ç å†—ä½™æ€§é«˜ï¼Œå› æ­¤æˆ‘ä»¬é€šè¿‡åˆ‡é¢å»è¿½åŠ è¿™äº›è¾…åŠ©ä¿¡æ¯ã€‚ä»¥ä¸ªäººæ¥å£ä¸ºä¾‹ï¼Œå…·ä½“æ­¥éª¤å¦‚ä¸‹ï¼š</p>
<p>1.åˆ›å»º<code>src/main/java/com/iceberry/aspect/PersonalApiContentAspect.java</code>åˆ‡é¢ç±»ï¼Œå¹¶ä½¿ç”¨æ³¨è§£æ³¨æ˜ï¼›</p>
<pre><code language="language-java" class="language-java">package com.iceberry.aspect;

import org.aspectj.lang.annotation.Aspect;
import org.springframework.core.annotation.Order;
import org.springframework.stereotype.Component;

@Aspect
@Component
@Order(1)
public class PersonalApiContentAspect {}
</code></pre>
<p>2.æ³¨æ˜åˆ‡ç‚¹å¹¶é€‰æ‹©åˆ‡å…¥æ—¶æœºåˆ›å»ºå¤„ç†æ–¹æ³•ï¼›</p>
<pre><code language="language-java" class="language-java">@Pointcut(&#34;bean(*PersonalController)&#34;)
public void pointCut() {}

/**
 * åˆ‡å…¥å‰è§¦å‘
 */
@Before(&#34;pointCut()&#34;)
public void doBefore() {}

/**
 * æ–¹æ³•æ­£å¸¸è¿”å›åè§¦å‘
 */
@AfterReturning(returning = &#34;returnData&#34;, pointcut = &#34;pointCut()&amp;&amp;args(id,year)&#34;, argNames = &#34;returnData,id,year&#34;)
public Object doAfterReturning(Object returnData, String id, String year) {}
</code></pre>
<p>3.åœ¨åˆ‡å…¥å‰ä»Webè¯·æ±‚ä¸Šä¸‹æ–‡è·å–è¯·æ±‚å’Œå“åº”å¯¹è±¡ï¼š</p>
<pre><code language="language-java" class="language-java">attributes = (ServletRequestAttributes) RequestContextHolder.getRequestAttributes();
response = attributes.getResponse();
request = attributes.getRequest();
</code></pre>
<p>4.åœ¨æ–¹æ³•æ­£å¸¸è¿”å›åå‘å“åº”Mapè¿½åŠ ä¿¡æ¯ï¼š</p>
<pre><code language="language-java" class="language-java">//è·å–æ–¹æ³•è¿”å›æ•°æ®
Map&lt;String, Object&gt; returnMap = (HashMap&lt;String, Object&gt;) returnData;

//è¿½åŠ æ—¶é—´æˆ³
returnMap.put(&#34;timestamp&#34;, formatter.format(new Date(System.currentTimeMillis())));

//è¿½åŠ è¯·æ±‚Id
returnMap.put(&#34;id&#34;, id);

//è¿½åŠ è¯·æ±‚å¹´ä»½
returnMap.put(&#34;year&#34;, year);

//è¿½åŠ å“åº”çŠ¶æ€ç 
returnMap.put(&#34;status&#34;, response.getStatus());

//è¿½åŠ å“åº”ä¿¡æ¯
returnMap.put(&#34;message&#34;, &#34;OK&#34;);

//è¿½åŠ urlåœ°å€
returnMap.put(&#34;url&#34;, request.getRequestURL());
return returnMap;
</code></pre>
<p>ğŸ‘‰è‡³æ­¤ï¼Œ<code>PersonalApiContentAspect.java</code>å®ç°å®Œæˆï¼Œå®Œæ•´ä»£ç è¯¦è§<a href="https://github.com/chnsx/chnsx-backend/blob/main/src/main/java/com/iceberry/aspect/PersonalApiContentAspect.java" target="_blank">PersonalApiContentAspect.java</a></p>
<p><code>AssetServiceAspect.java</code>ã€<code>StatisticsApiContentAspect.java</code>çš„å®ç°äºæ­¤ç±»ä¼¼ï¼Œå› æ­¤ä¸å†èµ˜è¿°ã€‚</p>
<h2 is-upgraded>å…¨å±€æ•è·å¼‚å¸¸</h2>
<p>å½“ç¨‹åºå‡ºç°è¿è¡Œæ—¶å¼‚å¸¸ï¼Œåº”å½“å°†å…¶æ•è·ï¼Œå¹¶å°†å¼‚å¸¸ä¿¡æ¯ä»¥å‹å¥½çš„æ–¹å¼è¿”å›ç»™å‰ç«¯ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥å®ç°ä¸€ä¸ªå¼‚å¸¸å¤„ç†å™¨ï¼Œå½“å¼‚å¸¸å‘ç”Ÿæ—¶ï¼Œå°†é”™è¯¯ä¿¡æ¯è¿½åŠ åˆ°å“åº”Mapå¹¶è¿”å›ç»™å‰ç«¯ã€‚ä¸ºåˆ†æ¸…æ¥šå‡ºé”™çš„å…·ä½“åŸå› ï¼Œå¯ä»¥è‡ªå®šä¹‰å‡ ä¸ªå¼‚å¸¸ç±»ï¼Œå…·ä½“å®ç°æ­¥éª¤å¦‚ä¸‹ï¼š</p>
<p>1.åˆ›å»º<code>src/main/java/com/iceberry/exception/DaoNullException.java</code>å¼‚å¸¸ç±»ï¼Œç»§æ‰¿<code>RuntimeException</code>ï¼›</p>
<pre><code language="language-java" class="language-java">package com.iceberry.exception;

public class DaoNullException extends RuntimeException {

    public DaoNullException(String message) {
        super(message);
    }
}
</code></pre>
<p>2.åˆ›å»º<code>src/main/java/com/iceberry/controller/ControllerExceptionHandler.java</code>å¼‚å¸¸å¤„ç†å™¨ï¼Œå¹¶åˆ›å»ºå¤„ç†å¼‚å¸¸çš„æ–¹æ³•<code>handleException</code>ï¼Œå‚æ•°ä¸ºå¼‚å¸¸å’ŒServletå“åº”å¯¹è±¡ï¼›</p>
<pre><code language="language-java" class="language-java">package com.iceberry.controller;

import org.springframework.web.bind.annotation.ExceptionHandler;
import org.springframework.web.bind.annotation.ResponseBody;
import org.springframework.web.bind.annotation.RestControllerAdvice;

import javax.servlet.http.HttpServletResponse;

@RestControllerAdvice
public class ControllerExceptionHandler {

    @ResponseBody
    @ExceptionHandler(Exception.class)
    public Map&lt;String, Object&gt; handleException(Exception e, HttpServletResponse response) {}
</code></pre>
<p>3.åˆ¤æ–­å¼‚å¸¸ç±»å‹ï¼Œæ ¹æ®ä¸åŒå¼‚å¸¸èµ‹äºˆmessageä¸åŒä¿¡æ¯ï¼›</p>
<pre><code language="language-java" class="language-java">String message;
if (e instanceof DaoNullException) {
    message = &#34;æ•°æ®åº“æŸ¥è¯¢ç»“æœä¸ºç©º&#34;;
} else if (e instanceof ConvertNameException) {
    message = &#34;è½¬æ¢ä¸­è‹±æ–‡å¤±è´¥&#34;;
} else if (e instanceof NullPointerException) {
    message = &#34;æŸ¥è¯¢çš„æ•°æ®ä¸ºç©º&#34;;
} else {
    message = &#34;æŸ¥è¯¢å¤±è´¥&#34;;
}
</code></pre>
<aside class="special"><p>ä¹Ÿå¯ä»¥åœ¨æ­¤æ ¹æ®ä¸åŒé”™è¯¯ç±»å‹èµ‹äºˆä¸åŒçŠ¶æ€ç ï¼Œä½¿å¾—åŒºåˆ†æ›´åŠ æ˜æ˜¾ã€‚</p>
</aside>
<p>4.åˆ›å»ºmapå¯¹è±¡ï¼Œå°†çŠ¶æ€ç ã€ä¿¡æ¯ã€æ—¶é—´æˆ³ç­‰ä¿¡æ¯è¿½åŠ å…¶ä¸­å¹¶è¿”å›ï¼›</p>
<pre><code language="language-java" class="language-java">Map&lt;String, Object&gt; map = new HashMap&lt;&gt;();
request = attributes.getRequest();
map.put(&#34;timestamp&#34;, formatter.format(new Date(System.currentTimeMillis())));
map.put(&#34;code&#34;, response.getStatus());
map.put(&#34;message&#34;, message);
map.put(&#34;exception&#34;, e.getClass());
map.put(&#34;url&#34;, request.getRequestURL());
return map;
</code></pre>
<p>ğŸ‘‰è‡³æ­¤ï¼Œå…¨å±€å¼‚å¸¸å¤„ç†å®ç°å®Œæ¯•ï¼Œå®Œæ•´ä»£ç è¯¦è§<a href="https://github.com/chnsx/chnsx-backend/blob/main/src/main/java/com/iceberry/controller/ControllerExceptionHandler.java" target="_blank">ControllerExceptionHandler.java</a></p>
<aside class="special"><p>å¦‚æ¬²äº†è§£æ›´å¤šå…³äºRestfulæ¶æ„ï¼Œå¯å‚è€ƒï¼š</p>
</aside>
<ul>
<li><a href="https://www.ics.uci.edu/~fielding/pubs/dissertation/fielding_dissertation.pdf" target="_blank">Architectural Styles and the Design of Network-based Software Architectures[D].University of California, Irvine,2000:76-106</a>ï¼ˆpdfï¼‰</li>
<li><a href="https://en.m.wikipedia.org/wiki/Representational_state_transfer" target="_blank">Representational_state_transfer</a>ï¼ˆwikipediaï¼‰</li>
<li><a href="https://www.ruanyifeng.com/blog/2011/09/restful.html" target="_blank">ç†è§£RESTfulæ¶æ„</a>ï¼ˆé˜®ä¸€å³°çš„ç½‘ç»œæ—¥å¿—ï¼‰</li>
</ul>


      </google-codelab-step>
    
      <google-codelab-step label="[ABé˜Ÿ]ç¼–å†™å•å…ƒæµ‹è¯•" duration="10">
        <h2 is-upgraded>ä¸ºä»€ä¹ˆéœ€è¦å•å…ƒæµ‹è¯•ï¼Ÿ</h2>
<ul>
<li>èŠ‚çœæµ‹è¯•æ—¶é—´  æµ‹è¯•ä¸€ä¸ªæœ€å°å•å…ƒæ˜¯å¦æœ‰é€»è¾‘é—®é¢˜ï¼Œæ— éœ€åˆ°æµ‹è¯•ç¯å¢ƒä¸­å»ï¼ˆæ¯”å¦‚åˆ›å»ºæ•°æ®åº“ï¼Œåˆ›å»ºæ–‡ä»¶ç­‰ä¸€äº›éº»çƒ¦ä¸”è€—æ—¶çš„æ“ä½œï¼‰ã€‚</li>
<li>é˜²æ­¢å›å½’  æˆ‘ä»¬å†™çš„ä¸œè¥¿ä¸ä¼šç ´åå·²æœ‰çš„åŠŸèƒ½ï¼Œç¡®ä¿æˆ‘ä»¬çš„ä¿®æ”¹å’Œè®¾è®¡ä¸ä¼šç ´åå·²æœ‰çš„åŠŸèƒ½ã€‚æ¯”å¦‚ä½ ä¿®æ”¹äº†ä¸€ä¸ªç±»ï¼Œè¿™ä¸ªç±»ä¼šè¢«å¾ˆå¤šå…¶ä»–çš„ç±»ä½¿ç”¨ï¼Œè¿™æ ·å¯èƒ½ä¼šé€ æˆä¸€äº›é—®é¢˜ã€‚æ‰€ä»¥å•å…ƒæµ‹è¯•åœ¨ä»£ç é‡æ„ä¸Šç›¸å½“é‡è¦ã€‚</li>
<li>æé«˜ä»£ç è´¨é‡</li>
<li>ä¿è¯è¡Œä¸ºçš„æ­£ç¡®æ€§  æ¯”å¦‚ä½ è¾“å…¥äº†ä¸€ä¸ªå¼‚å¸¸çš„æ•°ï¼Œå°±éœ€è¦æŠ›å¼‚å¸¸ã€‚</li>
</ul>
<h2 is-upgraded>å•å…ƒæµ‹è¯•è¯„ä»·æ ‡å‡†</h2>
<ul>
<li>å¿«é€Ÿã€‚å¯¹æˆç†Ÿé¡¹ç›®è¿›è¡Œæ•°åƒæ¬¡å•å…ƒæµ‹è¯•,è¿™å¾ˆå¸¸è§ã€‚åº”èŠ±éå¸¸å°‘çš„æ—¶é—´æ¥è¿è¡Œå•å…ƒæµ‹è¯•ã€‚</li>
<li>ç‹¬ç«‹ã€‚å•å…ƒæµ‹è¯•æ˜¯ç‹¬ç«‹çš„,å¯ä»¥å•ç‹¬è¿è¡Œ,å¹¶ä¸”ä¸ä¾èµ–æ–‡ä»¶ç³»ç»Ÿæˆ–æ•°æ®åº“ç­‰ä»»ä½•å¤–éƒ¨å› ç´ ã€‚å¦‚æœçœŸçš„è¿æ•°æ®åº“æˆ‘ä»¬å«å®ƒé›†æˆæµ‹è¯•ã€‚</li>
<li>å¯é‡å¤ã€‚è¿è¡Œå•å…ƒæ¸¬è¯•çš„ç»“æœåº”è¯¥ä¿æŒä¸€è‡´ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœåœ¨è¿è¡ŒæœŸé—´ä¸æ›´æ”¹ä»»ä½•å†…å®¹ï¼Œæ€»æ˜¯è¿”å›ç›¸åŒçš„ç»“æœã€‚</li>
<li>è‡ªæ£€æŸ¥ã€‚æµ‹è¯•åº”è¯¥èƒ½å¤Ÿåœ¨æ²¡æœ‰ä»»ä½•äººå·¥äº¤äº’çš„æƒ…å†µä¸‹ï¼Œè‡ªåŠ¨æ£€æµ‹æµ‹è¯•æ˜¯å¦é€šè¿‡ã€‚</li>
</ul>
<h2 is-upgraded>é¡¹ç›®ä¸­ä½¿ç”¨çš„å•å…ƒæµ‹è¯•</h2>
<p>è¯¥é¡¹ç›®ä¸­ä½¿ç”¨çš„æ˜¯ç®€å•çš„Junit5å•å…ƒæµ‹è¯•ï¼Œä¸»è¦æµ‹è¯•Mapperå±‚å’ŒServiceå±‚çš„åŠŸèƒ½æ˜¯å¦å®ç°ã€‚ç°åœ¨ä¸¾Mapperå±‚ä¸€ä¸ªä¾‹å­è¯´æ˜ç”¨æ³•ã€‚</p>
<p><strong>Mapperå±‚æµ‹è¯•</strong>ï¼šæµ‹è¯•Mapperå±‚çš„findHlth12Oneæ–¹æ³•ä»æ•°æ®åº“ä¸­èƒ½å¦è·å–åˆ°æ•°æ®ï¼Œå°†è·å–åˆ°çš„æ•°æ®æ‰“å°åœ¨æ§åˆ¶å°ã€‚</p>
<p>é¦–å…ˆåˆ›å»º<code>src/test/java/com/iceberry/mapper/MedicalMapperTests.java</code>æµ‹è¯•ç±»ï¼Œä½¿ç”¨<code>@SpringBootTest</code>æ³¨è§£æ ‡æ³¨è¯¥ç±»ä¸ºæµ‹è¯•ç±»ï¼Œå¹¶è‡ªåŠ¨æ³¨å…¥medicalMapperå¯¹è±¡ï¼Œç„¶ååˆ›å»ºä¸€ä¸ªæ ‡æœ‰<code>@Test</code>æ³¨è§£çš„<code>findHlth12OneTest</code>æ–¹æ³•ä¸ºä¸€ä¸ªæµ‹è¯•å•å…ƒã€‚</p>
<pre><code language="language-java" class="language-java">package com.iceberry.mapper;

import org.junit.jupiter.api.Test;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.test.context.SpringBootTest;

import java.util.Map;

@SpringBootTest
public class MedicalMapperTests {
    @Autowired
    private MedicalMapper medicalMapper;
    
    @Test
    public void findHlth12OneTest() {}
}
</code></pre>
<p>æ¥ç€åœ¨æ–¹æ³•å†…ç¼–å†™æµ‹è¯•é€»è¾‘å³å¯ï¼Œæ­¤å¤„å°†mapperå±‚è·å–åˆ°çš„æ•°æ®æ‰“å°åœ¨æ§åˆ¶å°ã€‚</p>
<pre><code language="language-java" class="language-java">Map&lt;String, Object&gt; map = medicalMapper.findHlth12One(&#34;111101001002&#34;, &#34;2015&#34;);
System.out.println(map);
</code></pre>
<p>ä¹‹åç‚¹å‡»æ–¹æ³•å‰é¢çš„â–¶æŒ‰é’®å³å¯è¿è¡Œè¯¥æµ‹è¯•ï¼Œå½“æµ‹è¯•æˆåŠŸæ—¶ï¼Œä¼šæ˜¾ç¤ºâˆšå’ŒTests passedå­—æ ·ï¼Œæµ‹è¯•å¤±è´¥æ—¶ï¼Œä¼šæ˜¾ç¤ºçº¢è‰²çš„Tests failedå­—æ ·å’Œé”™è¯¯å †æ ˆä¿¡æ¯ã€‚</p>
<p class="image-container"><img alt="image-å•å…ƒæµ‹è¯•" src="img\\9110405874d2577d.png"></p>
<p>æ‚¨ä¹Ÿå¯ä»¥é€šè¿‡<code>Assert</code>å·¥å…·éªŒè¯è¡Œä¸ºæ˜¯å¦ç¬¦åˆé¢„æœŸã€‚æ¯”å¦‚ç°åœ¨è§„å®šå¾—åˆ°çš„mapä¸èƒ½ä¸ºnullå€¼ï¼Œå¦‚æœä¸ºnullï¼Œåˆ™è¡¨ç¤ºæµ‹è¯•å¤±è´¥ï¼Œåˆ™æ‚¨å¯ä»¥è¿™æ ·ç¼–å†™æµ‹è¯•é€»è¾‘ï¼š</p>
<pre><code language="language-java" class="language-java">Map&lt;String, Object&gt; map = medicalMapper.findHlth12One(&#34;111101001002&#34;, &#34;2015&#34;);
//System.out.println(map);
Assert.notNull(map,&#34;mapä¸èƒ½ä¸ºç©ºï¼&#34;);
</code></pre>
<p>å°è¯•æ›´æ”¹å¹´ä»½å’ŒIdï¼Œå¯ä»¥æŸ¥çœ‹ä¸åŒæµ‹è¯•ç»“æœä¸‹çš„ä¸åŒè¡¨ç°ã€‚</p>
<aside class="special"><p>æ­¤å¤–ï¼Œæ‚¨ä¹Ÿå¯ä»¥æµ‹è¯•Controllerå±‚ï¼Œè¿™å°†ç”¨åˆ°Spring MockMvcï¼Œæ‚¨å¯ä»¥å‚è€ƒ<a href="https://spring.io/guides/gs/testing-web/" target="_blank">Testing the Web Layer</a></p>
</aside>


      </google-codelab-step>
    
      <google-codelab-step label="æ‰“åŒ…å‘å¸ƒ" duration="5">
        <p>æ‚¨éœ€è¦ä½¿ç”¨mavenå·¥å…·è¿›è¡Œæ‰“åŒ…ï¼Œå¦‚æœæ‚¨ä½¿ç”¨IDEAï¼Œåˆ™ç›´æ¥ç‚¹å‡»ä¾§è¾¹mavené€‰é¡¹å¡&gt;<code>package</code>å³å¯ã€‚</p>
<p class="image-container"><img alt="image-ä½¿ç”¨mavenæ‰“åŒ…é¡¹ç›®" src="img\\7cbdcc4bbf751fcb.png"></p>
<p>æ‰“åŒ…å®Œæˆåçš„æ–‡ä»¶ä½äºé¡¹ç›®çš„<code>/target</code>æ–‡ä»¶å¤¹ä¸‹ã€‚</p>
<p class="image-container"><img alt="image-æ‰“åŒ…åçš„æ–‡ä»¶" src="img\\955d5ff35a7c4965.png"></p>
<p>æ‚¨å¯ä»¥åœ¨è¯¥è·¯å¾„ä¸‹é€šè¿‡è¿è¡Œä»¥ä¸‹å‘½ä»¤å¯åŠ¨æœåŠ¡ç«¯ï¼š</p>
<pre><code language="language-java" class="language-java">java -jar chns-0.0.5-SNAPSHOT.jar
</code></pre>
<p>å¾…æœåŠ¡å™¨å¯åŠ¨åï¼Œæ‚¨å¯ä»¥ä½¿ç”¨æµè§ˆå™¨æ‰“å¼€<a href="http://localhost:8080/api" target="_blank">localhost:8080/api</a>è®¿é—®Apiæ–‡æ¡£é¡µé¢ï¼Œæ‚¨ä¹Ÿå¯ä»¥é€šè¿‡Postmanæˆ–è€…curlå¯¹è¿™äº›æ¥å£è¿›è¡Œè®¿é—®æˆ–æµ‹è¯•ï¼Œä¾‹å¦‚ä½¿ç”¨curlå·¥å…·è®¿é—®å…¶ä¸­ä¸€ä¸ªæ¥å£å¦‚ä¸‹ï¼š</p>
<pre><code language="language-bash" class="language-bash">curl -X GET http://localhost:8080//chnsx/medical/personal/111101166001/disease -G -d &#39;year=2015&#39; -v
</code></pre>


      </google-codelab-step>
    
      <google-codelab-step label="å¸¸è§é—®é¢˜" duration="18">
        <p><strong>Qï¼šé¡¹ç›®ä¾èµ–æœ‰äº›ç‰ˆæœ¬è€æ—§ï¼Œæˆ‘å¯ä»¥ä½¿ç”¨æ–°ç‰ˆå—ï¼Ÿ</strong></p>
<p>æ‚¨å¯ä»¥åœ¨äº†è§£è¯¥ä¾èµ–çš„å‘åå…¼å®¹æ€§åå†é€‰æ‹©æ›´æ–°ï¼Œå»ºè®®ä½¿ç”¨ä¾èµ–æ–‡ä»¶ä¸­è§„å®šçš„ç‰ˆæœ¬ã€‚</p>
<p><strong>Qï¼šæ•°æ®åº“å­—æ®µè¯­ä¹‰åŒ–çš„å·¥ä½œå¼‚å¸¸ç¹æ‚ï¼Œæœ‰æ— æ›´ä¸ºç®€ä¾¿çš„æ–¹æ³•ï¼Ÿ</strong></p>
<p>æ•°æ®åº“å­—æ®µè¯­ä¹‰åŒ–çš„å·¥ä½œè‡³å°‘å˜æ›´äº†3ä¸ªç‰ˆæœ¬ã€‚èµ·åˆæ˜¯æ‰“ç®—ç›´æ¥æ•´ç†æ•°æ®åº“ï¼Œå°†å…¶ç»“æ„æ•´ç†ä¸ºç¨‹åºå¯ä»¥ç›´æ¥ä½¿ç”¨çš„ç‰ˆæœ¬ï¼Œå¹¶å°†ä¸€äº›æ•°é‡ã€æ¦‚ç‡ç­‰ç›´æ¥åœ¨æ•°æ®åº“ä¸­è®¡ç®—å‡ºæ¥ä½œä¸ºä¸€åˆ—ï¼Œè¿™å…¶ä¸­å°±åŒ…æ‹¬æ•°æ®åº“ä¸­è‹±æ–‡å­—æ®µè½¬æ¢å·¥ä½œã€‚</p>
<p>ä½†æ˜¯åœ¨æ•°æ®åº“ä¸­ç›´æ¥äººå·¥æ“ä½œæ—¶ï¼Œåˆé‡åˆ°è€—æ—¶é•¿ã€æ•°æ®åº“è¡¨ç»“æ„ä¸ç»Ÿä¸€ã€æ•°æ®ä¼šæ˜¯å®æ—¶åŠ¨æ€å˜åŒ–çš„ï¼Œå› æ­¤å°±æ”¾å¼ƒè¿™ä¸€åšæ³•ï¼Œæ”¹ä¸ºä»ç¨‹åºä¸­å¤„ç†ï¼Œè¿™æ ·çš„å¥½å¤„æ˜¯åªè¦æ•°æ®åº“ç»“æ„ä¸æ”¹å˜ï¼Œç¨‹åºä¸ä¼šå‡ºé”™ã€‚</p>
<p>ç¨‹åºå¤„ç†çš„è¯ï¼Œéœ€è¦æœ‰ä¸€ä¸ªä¸­è‹±æ–‡æ˜ å°„è¡¨ï¼Œä¸€å¼€å§‹æˆ‘é€‰æ‹©ä½¿ç”¨Gsonå·¥å…·å°†ä¸€ç³»åˆ—å­—æ®µåŒ…å«åœ¨ç±»å†…ï¼Œä½¿ç”¨æ³¨è§£æ ‡æ³¨å…¶ä¸­æ–‡å«ä¹‰ï¼Œè®©å…¶è‡ªåŠ¨è½¬æ¢ï¼Œè¿™æ˜¯å¯è¡Œçš„ï¼Œæ­¤æ³•çš„éƒ¨åˆ†å®ç°å¦‚ä¸‹æ‰€ç¤ºï¼Œå®Œæ•´ä»£ç è¯¦è§<a href="https://github.com/chnsx/chns/blob/master/src/main/java/com/iceberry/domain/M24BPerson.java" target="_blank"><strong>M24BPerson.java</strong></a>.</p>
<pre><code language="language-java" class="language-java">package com.iceberry.domain;

import com.google.gson.annotations.SerializedName;

import java.io.Serializable;

public class M24BPerson implements Serializable {
    @SerializedName(&#34;ID&#34;)
    private String IDind;
    @SerializedName(&#34;å®¶åº­ID&#34;)
    private int hhid;
    @SerializedName(&#34;å¹´ä»½&#34;)
    private int wave;
    @SerializedName(&#34;å‘çƒ§-å–‰å’™ç—›-å’³å—½&#34;)
    private String M24B_1;
    ......
}
</code></pre>
<p>ä½†æ˜¯ç¼ºç‚¹æ˜¯å½“æœ‰æ–°å­—æ®µæ—¶ï¼Œéœ€è¦æ›´æ”¹ç¨‹åºä»£ç ï¼Œè¿™æå¤§çš„é™åˆ¶äº†ç¨‹åºçš„å¯æ‰©å±•æ€§ï¼Œäºæ˜¯å¼€å§‹å¦å¯»å®ƒæ³•ã€‚åæ¥å­¦ä¹ Spring Booté…ç½®æ–‡ä»¶æ—¶ï¼Œæƒ³åˆ°å°†ä¸­è‹±æ–‡æ˜ å°„æ”¾åœ¨é…ç½®æ–‡ä»¶ä¸­ï¼Œè¿™æ ·æ›´æ”¹é…ç½®æ–‡ä»¶æ—¶å°±æ— éœ€æ›´æ”¹ä»£ç ï¼Œäºæ˜¯æ‰æœ‰äº†ç°åœ¨çš„åšæ³•ã€‚</p>
<p>å…³äºæ›´å¥½çš„æ•°æ®åº“å­—æ®µè¯­ä¹‰åŒ–çš„æ–¹æ³•ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨ç¨‹åºå¤„ç†æ•°æ®åº“ï¼Œå°†å¤„ç†å®Œçš„æ•°æ®å†™åˆ°æ–°çš„æ•°æ®åº“è¡¨å½“ä¸­ï¼Œå¹¶å®šæ—¶æ‰§è¡Œä»»åŠ¡ï¼Œåç«¯ä»æ–°æ•´ç†å¥½çš„æ•°æ®åº“ä¸­è¯»å–æ•°æ®ï¼Œä½†è¿™ä¼šå½±å“åŠæ—¶æ€§ï¼Œæ‰§è¡Œé—´éš”è¿‡çŸ­åˆä¼šå¼•èµ·æ€§èƒ½é—®é¢˜ã€‚ä¹Ÿå¯ä»¥è€ƒè™‘ä½¿ç”¨å…¶å®ƒå·¥å…·æ¯”å¦‚<a href="https://www.elastic.co/cn/elasticsearch/" target="_blank">elasticsearch</a>æˆ–è€…æ•°æ®æŒ–æ˜çš„æ–¹å¼å»è§£å†³ã€‚</p>
<p><strong>Qï¼šæ–‡ä¸­çš„ä»£ç ç†è§£èµ·æ¥ååˆ†å›°éš¾ï¼Œæˆ‘åº”è¯¥å…ˆå­¦ä¹ Spring Bootç›¸å…³çŸ¥è¯†å—ï¼Ÿ</strong></p>
<p>æ‚¨åº”è¯¥è‡³å°‘å­¦ä¹ Java webå’ŒSpringçš„åŸºç¡€çŸ¥è¯†åæ‰èƒ½ç†è§£è¿™äº›ä»£ç çš„å«ä¹‰ï¼Œæœ¬æ•™ç¨‹çš„ç›®çš„åœ¨äºä»‹ç»å¾®è§‚ä¸­å›½åç«¯çš„å®ç°æµç¨‹ï¼Œå³ä½¿æ‚¨æ²¡æœ‰åç«¯å¼€å‘çš„ç›¸å…³ç»éªŒå’ŒçŸ¥è¯†ï¼Œä¹Ÿå¯ä»¥æ ¹æ®æœ¬æ•™ç¨‹æ­å»ºèµ·å¾®è§‚ä¸­å›½åç«¯å¹¶ä»¿ç…§é¡¹ç›®çš„åšæ³•æ·»åŠ æ–°çš„åŠŸèƒ½ã€‚</p>
<p><strong>Qï¼šæ—¢ç„¶æœ‰äº›ç±»å’Œæ–¹æ³•å·²ç»å¼ƒç”¨ï¼Œä¸ºä½•ä¸ç›´æ¥åˆ é™¤ï¼Ÿ</strong></p>
<p>è™½ç„¶å®ƒä»¬è¢«æ ‡è®°ä¸ºå¼ƒç”¨çŠ¶æ€ï¼Œä½†æ˜¯æœ‰äº›ä»£ç ä»ç„¶ç”¨åˆ°å®ƒä»¬ï¼Œåœ¨æœ‰æ–°çš„æ–¹æ³•æ›¿ä»£å®ƒä»¬ä¹‹å‰ä¸ä¼šè¢«åˆ é™¤ï¼Œä½†åœ¨è¿›è¡Œæ–°çš„å¼€å‘å·¥ä½œæ—¶åº”å°½é‡é¿å…ä½¿ç”¨è¿™äº›æ–¹æ³•ã€‚</p>
<p><strong>Qï¼šSqlè¯­å¥å¦‚æ­¤å†—é•¿ï¼Œæœ‰æ— è§£å†³åŠæ³•ï¼Ÿ</strong></p>
<p>Sqlè¯­å¥çŸ­æ˜¯ç‰ºç‰²äº†æ‰§è¡Œæ—¶é—´ï¼ŒSqlè¯­å¥æ‰§è¡Œæ—¶é—´çŸ­åˆ™ç‰ºç‰²äº†é•¿åº¦ã€‚å¦‚æœæ‚¨æœ‰ä¸¤å…¨å…¶ç¾çš„åŠæ³•ï¼Œæ‚¨å¯ä»¥å°è¯•åœ¨é¡¹ç›®ä¸­è½å®æ‚¨çš„æ–¹æ¡ˆå¹¶é€æ­¥æ›¿ä»£å†—é•¿çš„Sqlè¯­å¥ã€‚</p>
<p><strong>Qï¼šä¸ºä»€ä¹ˆä¸ç”¨å¯¹è±¡å»æ˜ å°„è¿”å›å€¼ï¼Œè€Œæ˜¯ç”¨Map&lt;String,Object&gt;ç±»å‹ï¼Ÿè¿™ä¸æ˜¯è¿èƒŒé¢å‘å¯¹è±¡çš„åˆè¡·å—ï¼Ÿ</strong></p>
<p>å› ä¸ºéœ€è¦åŠ¨æ€æ›´æ”¹å±æ€§åå’Œéå†ã€è¿‡æ»¤æ“ä½œï¼Œç´¢æ€§ä½¿ç”¨äº†Mapå¯¹è±¡ã€‚</p>
<p><strong>Qï¼šç¼–å†™æ¥å£æ—¶ï¼Œä¸ºä»€ä¹ˆidæ˜¯åŠ¨æ€è·¯å¾„å˜é‡ï¼Œyearæ˜¯æŸ¥è¯¢å‚æ•°ï¼Ÿå¿…é¡»æ˜¯è¿™æ ·å—ï¼Ÿ</strong></p>
<p>è¿™ä¸æ˜¯å¿…é¡»çš„ï¼Œæ‚¨å®Œå…¨å¯ä»¥è‡ªå·±æ›´æ”¹è§„åˆ™ï¼Œè¿™åªæ˜¯ä¸€ç§æ–¹å¼è€Œå·²ã€‚</p>
<p><strong>Qï¼šServiceå±‚ä¸ºä»€ä¹ˆè¦ä½¿ç”¨@Transactionalæ³¨è§£ï¼Ÿ</strong></p>
<p>è¿™ä¸æ•°æ®åº“äº‹åŠ¡ç›¸å…³ï¼Œä½†è¯¥é¡¹ç›®ä¸­å¹¶æ²¡æœ‰æ¶‰åŠæ•°æ®åº“çš„å¢åˆ æ”¹æ“ä½œï¼Œå› æ­¤æ²¡æœ‰ä»»ä½•ç”¨å¤„ï¼Œæ­¤å¤„ä¿ç•™æ˜¯ä¸ºåç»­é¡¹ç›®å‘å±•åšé“ºå«ã€‚</p>
<p><strong>Qï¼šä¸ºä»€ä¹ˆä½¿ç”¨åˆ‡é¢(Aspect)è€Œä¸æ˜¯æ‹¦æˆªå™¨(Filter)ï¼Ÿ</strong></p>
<p>å½“æ”¶åˆ°è¯·æ±‚å“åº”æ—¶ï¼Œæ‰§è¡Œçš„é¡ºåºä¸ºfilter-&gt;interceptor-&gt;ControllerAdvice-&gt;Aspectï¼Œç„¶ååˆ°è¾¾æ§åˆ¶å±‚ï¼Œå¦‚æœæ§åˆ¶å±‚æŠ›å‡ºå¼‚å¸¸ï¼Œæœ€å…ˆä¹Ÿä¼šè¢«Aspectæ•è·ï¼Œå¦‚æœæœªå¤„ç†ï¼Œä¼šç»§ç»­å‘ä¸Šä¸€å±‚æŠ›å‡ºï¼Œå¦‚æœåˆ°Filterä¹Ÿæ²¡æœ‰å¤„ç†çš„è¯ï¼Œå°±ä¼šæŠ›åˆ°å®¹å™¨å†…éƒ¨ï¼Œä¸ºäº†èƒ½å¤Ÿæœ€å…ˆå’Œæœ€å…¨æ•è·å¼‚å¸¸ï¼Œé€‰æ‹©Aspectè¿›è¡Œé”™è¯¯å¤„ç†å’Œæ—¥å¿—å¤„ç†ã€‚æ‚¨å¯ä»¥å°è¯•ä½¿ç”¨Filterå®ç°æ—¥å¿—åŠŸèƒ½ã€‚</p>
<p><strong>Qï¼šä¸ºä»€ä¹ˆæ€»æ˜¯ä½¿ç”¨è‡ªåŠ¨æ³¨å…¥ï¼Ÿä¸ºä»€ä¹ˆä¸ä½¿ç”¨å…¨å±€é™æ€å˜é‡å’Œæ–¹æ³•ï¼Ÿ</strong></p>
<p>springæ¡†æ¶åº”ç”¨ä¸­æœ‰äº›é™æ€æ–¹æ³•éœ€è¦ä¾èµ–è¢«å®¹å™¨ç®¡ç†çš„ç±»ã€‚é™æ€å˜é‡ã€ç±»å˜é‡ä¸æ˜¯å¯¹è±¡å±æ€§ï¼Œè€Œæ˜¯ä¸€ä¸ªç±»çš„å±æ€§ï¼Œæ‰€ä»¥é™æ€æ–¹æ³•æ˜¯å±äºç±»ï¼ˆclassï¼‰çš„ï¼Œæ™®é€šæ–¹æ³•æ‰æ˜¯å±äºå®ä½“å¯¹è±¡çš„ï¼ˆnewå‡ºæ¥çš„å¯¹è±¡ï¼‰ï¼Œspringæ³¨å…¥æ˜¯åœ¨å®¹å™¨ä¸­å®ä¾‹åŒ–å¯¹è±¡ï¼Œæ‰€ä»¥ä¸èƒ½ä½¿ç”¨é™æ€æ–¹æ³•ã€‚ä½¿ç”¨é™æ€å˜é‡ã€ç±»å˜é‡æ‰©å¤§äº†é™æ€æ–¹æ³•çš„ä½¿ç”¨èŒƒå›´ã€‚</p>
<p>é™æ€æ–¹æ³•åœ¨springä¸­æ˜¯ä¸æ¨èä½¿ç”¨çš„ï¼Œä¾èµ–æ³¨å…¥çš„ä¸»è¦ç›®çš„æ˜¯è®©å®¹å™¨å»äº§ç”Ÿä¸€ä¸ªå¯¹è±¡çš„å®ä¾‹ï¼Œç„¶åäº¤ç»™springå®¹å™¨ç®¡ç†ï¼Œåœ¨æ•´ä¸ªç”Ÿå‘½å‘¨æœŸä¸­ä½¿ç”¨ä»–ä»¬ï¼Œæ›´åŠ æ–¹ä¾¿çµæ´»ã€‚</p>
<p>ä¸€æ—¦ä½ ä½¿ç”¨é™æ€æ–¹æ³•ï¼Œå°±ä¸å†éœ€è¦å»äº§ç”Ÿè¿™ä¸ªç±»çš„å®ä¾‹ï¼Œè¿™ä¼šè®©testingå˜å¾—æ›´åŠ å›°éš¾ï¼ŒåŒæ—¶ä½ ä¹Ÿä¸èƒ½ä¸ºä¸€ä¸ªç»™å®šçš„ç±»ï¼Œä¾é æ³¨å…¥æ–¹å¼å»äº§ç”Ÿå¤šä¸ªå…·æœ‰ä¸åŒçš„ä¾èµ–ç¯å¢ƒçš„å®ä¾‹ï¼Œè¿™ç§static fieldæ˜¯éšå«å…±äº«çš„ï¼Œå¹¶ä¸”æ˜¯ä¸€ç§globalå…¨å±€çŠ¶æ€ï¼ŒspringåŒæ ·ä¸æ¨èè¿™æ ·å»åšã€‚</p>
<p><strong>Qï¼šä¸ºä»€ä¹ˆæˆ‘æ‰“åŒ…æˆjaræ–‡ä»¶æ—¶å‡ºé”™ï¼Ÿ</strong></p>
<p>å¦‚æœæ‚¨åœ¨ä¸æ‰“åŒ…æ—¶è¿è¡Œä¹ŸæŠ¥é”™ï¼Œåˆ™æ˜¯ç¨‹åºä»£ç æœ‰é—®é¢˜ï¼›å¦‚æœä»…æ˜¯æ‰“åŒ…å‡ºé”™ï¼Œåˆ™å¯èƒ½æ˜¯æœªèƒ½é€šè¿‡æ‰€æœ‰çš„å•å…ƒæµ‹è¯•ï¼Œä¹Ÿå¯èƒ½æ˜¯mavenå·¥å…·æœ‰é—®é¢˜ã€‚</p>
<p>æ‚¨å¯ä»¥å…ˆè¿è¡Œæ‰€æœ‰çš„æµ‹è¯•ç”¨ä¾‹ï¼Œç¡®ä¿å…¨éƒ¨é€šè¿‡åå†è¿›è¡Œæ‰“åŒ…æ“ä½œï¼Œå¦‚æœä»å‡ºç°é—®é¢˜ï¼Œåˆ™å¯èƒ½æ˜¯mavené…ç½®å‡ºç°é—®é¢˜æˆ–è€…å·¥å…·æœ¬èº«æœ‰é—®é¢˜ï¼Œæ‚¨å¯ä»¥æ ¹æ®é”™è¯¯å †æ ˆä¿¡æ¯å¯»æ‰¾å‡ºé”™åŸå› ã€‚</p>


      </google-codelab-step>
    
      <google-codelab-step label="ä¸‹ä¸€æ­¥" duration="3">
        <p>ğŸ‰æ­å–œä½ å·²ç»å®Œæˆæœ¬è¯¾ç¨‹çš„å…¨éƒ¨å†…å®¹ï¼åœ¨æœ¬èŠ‚è¯¾ä¸­ï¼Œä½ å·²ç»å­¦åˆ°ï¼š</p>
<ul>
<li>å¦‚ä½•ç¼–å†™å¾®è§‚ä¸­å›½æœåŠ¡ç«¯çš„æ§åˆ¶å™¨</li>
<li>å¦‚ä½•ç¼–å†™mapperå±‚å’ŒSqlæ˜ å°„æ–‡ä»¶</li>
<li>å¦‚ä½•è®°å½•Webè®¿é—®æ—¥å¿—</li>
<li>å¦‚ä½•ç¼–å†™å¾®è§‚ä¸­å›½Serviceå±‚</li>
<li>å¦‚ä½•ç¼–å†™åˆ‡é¢å®ç°å…¨å±€åŠŸèƒ½</li>
<li>å¦‚ä½•ä¸ºé¡¹ç›®ç¼–å†™å•å…ƒæµ‹è¯•</li>
<li>å¦‚ä½•å°†é¡¹ç›®æ‰“åŒ…ä¸ºå¯ç‹¬ç«‹è¿è¡Œçš„jaræ–‡ä»¶</li>
</ul>
<p>åé¢çš„è¯¾ç¨‹å°†å¸¦æ‚¨ä¸ºå¾®è§‚ä¸­å›½æœåŠ¡ç«¯ç¼–å†™å…¨æ–°çš„æœç´¢åŠŸèƒ½ã€‚åˆ°ç›®å‰ä¸ºæ­¢ï¼Œå¾®è§‚ä¸­å›½åç«¯çš„è¯¾ç¨‹å·²ç»æ¥è¿‘å°¾å£°äº†ï¼Œæ‚¨å¯ä»¥åå¤é˜…è¯»ä»¥åŠ æ·±æ‚¨å¯¹å¾®è§‚ä¸­å›½æœåŠ¡ç«¯çš„ç†è§£ã€‚</p>


      </google-codelab-step>
    
  </google-codelab>

  <script src="https://storage.googleapis.com/codelab-elements/native-shim.js"></script>
  <script src="https://storage.googleapis.com/codelab-elements/custom-elements.min.js"></script>
  <script src="https://storage.googleapis.com/codelab-elements/prettify.js"></script>
  <script src="https://storage.googleapis.com/codelab-elements/codelab-elements.js"></script>
  <script src="../../js/Inject.js"></script>

</body>
</html>
